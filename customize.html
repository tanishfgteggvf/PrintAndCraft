function doPost(e) {
  try {
    var data = JSON.parse(e.postData.contents);
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("Orders");
    var folderName = "Print_Craft_Designs";
    var folder, folders = DriveApp.getFoldersByName(folderName);
    
    if (folders.hasNext()) {
      folder = folders.next();
    } else {
      folder = DriveApp.createFolder(folderName);
    }

    var links = [];
    if (data.images && data.images.length > 0) {
      data.images.forEach(function(img) {
        var contentType = "image/" + img.name.split('.').pop();
        var decodeImg = Utilities.base64Decode(img.data);
        var blob = Utilities.newBlob(decodeImg, contentType, img.name);
        var file = folder.createFile(blob);
        file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW);
        links.push(file.getUrl());
      });
    }

    // Append to sheet: Timestamp, Name, Phone, Product, Details, Notes, Image Links
    sheet.appendRow([
      new Date(), 
      data.name, 
      "'" + data.phone, // Adding "'" prevents Excel from cutting off leading zeros
      data.product, 
      data.details, 
      data.notes, 
      links.join("\n") // Multiple links will be on new lines in one cell
    ]);

    return ContentService.createTextOutput("Success").setMimeType(ContentService.MimeType.TEXT);
  } catch (f) {
    return ContentService.createTextOutput("Error: " + f.toString()).setMimeType(ContentService.MimeType.TEXT);
  }
}
